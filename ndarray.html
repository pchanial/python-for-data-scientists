<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The array model &mdash; Python for Data Scientists, 2014.02</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2014.02',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Python for Data Scientists, 2014.02" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="index.html">Python for Data Scientists, 2014.02</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="the-array-model">
<h1>The array model<a class="headerlink" href="#the-array-model" title="Permalink to this headline">¶</a></h1>
<p>The Numpy array model is quite powerful, but before delving into the details on how Numpy arrays can be manipulated, it is interesting to understand why they are much more efficient than Python lists.
First, when a Numpy array is created, its elements are stored one next to the other (the memory storage is contiguous, see figure on the left for a 2-dimensional array), whereas in a Python list, elements are created before the list and they can be stored wherever in the memory (the memory storage is scattered, see figure on the right). In most systems, data from the main memory is transferred to the CPU via layers of caches, which implies that memory transfers from the cache to the CPU involve whole chunks of contiguous memory (a cache line) even if only few bytes in the cache line are actually requested by the CPU. As a consequence, a non-contiguous memory storage of the data will force the transfer of unneeded data from the cache and will incur a bandwidth penalty. In addition to that, modern architectures also have the possibility to anticipate transfers from the memory by prefetching the next cache lines. This mechanism will obviously better work when the data storage is contiguous. A second advantage of Numpy&#8217;s arrays over Python&#8217;s lists is that all elements occupy the same number of bytes, and as a consequence, the location of an element in the memory (its address) can be cheaply computed from its index and the location of the first element.
There is no such relationship in Python lists: the location of each element has to be stored in the memory, so that every read or write access has the indirection overhead of transferring this element location to the CPU beforehand.</p>
<a class="reference internal image-reference" href="_images/layout_2darray.png"><img alt="_images/layout_2darray.png" src="_images/layout_2darray.png" style="width: 40%;" /></a>
<a class="reference internal image-reference" href="_images/layout_listoflist.png"><img alt="_images/layout_listoflist.png" src="_images/layout_listoflist.png" style="width: 40%;" /></a>
<p>The NumPy array (<tt class="docutils literal"><span class="pre">ndarray</span></tt>) is defined by 4 attributes:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">dtype:</th><td class="field-body"><p class="first">The common type of the array&#8217;s data. It can be a basic data type such as integer, float and string of fixed length, or a structured data type which combines basic data types into records (more on this topic <a class="reference internal" href="#section-structured-dtype"><em>below</em></a>). NumPy provides many more basic data types than Python does (<tt class="docutils literal"><span class="pre">int8</span></tt>, <tt class="docutils literal"><span class="pre">int16</span></tt>, <tt class="docutils literal"><span class="pre">int32</span></tt>, <tt class="docutils literal"><span class="pre">int64</span></tt>, <tt class="docutils literal"><span class="pre">uint8</span></tt>, <tt class="docutils literal"><span class="pre">uint16</span></tt>, ..., <tt class="docutils literal"><span class="pre">float16</span></tt>, <tt class="docutils literal"><span class="pre">float32</span></tt>, <tt class="docutils literal"><span class="pre">float64</span></tt>, <tt class="docutils literal"><span class="pre">float128</span></tt> etc.).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The set of the 24 basic data types can also be extended. A <a class="reference external" href="https://github.com/martinling/numpy_quaternion">non-official extension</a> defines a basic data type for quaternions for which usual operations are provided.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In Python, integer representation is only limited by the available memory and operations on integers never overflow. This convenience has a computational cost that is avoided by NumPy. The NumPy&#8217;s data types encode integers by using a fixed number of bytes and thus they can silently overflow.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The name <tt class="docutils literal"><span class="pre">float128</span></tt> is misleading. This data type is unlikely to represent quadruple precision (but C type <tt class="docutils literal"><span class="pre">long</span> <span class="pre">double</span></tt> instead). Try:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float128</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mf">0.00097656</span><span class="p">,</span> <span class="mf">1.1920929e-07</span><span class="p">,</span> <span class="mf">2.2204460492503131e-16</span><span class="p">,</span> <span class="mf">1.084202172485504434e-19</span><span class="p">]</span>
</pre></div>
</div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">shape:</th><td class="field-body"><p class="first">A tuple containing the array dimensions (the length of the array axes, in NumPy terminology).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>a dimension of zero is valid</li>
<li>the shape <tt class="docutils literal"><span class="pre">()</span></tt> is valid, it corresponds to a 0-ranked array, similar to a scalar.</li>
</ul>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">strides:</th><td class="field-body"><p class="first">A tuple containing how many bytes should be walked in the memory to go from one element to the next one along each dimension.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(40, 8)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The fast dimension is that with the smallest stride. By default, when an array is created, it is the last one (row-major storage order like C and unlike Fortran, Matlab and IDL), but note that this is not the case for every array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(8, 40)</span>
</pre></div>
</div>
<p class="last">When iterating through a multi-dimensional array (check beforehand that you really have to...), make sure that you are indexing first the actual slow dimension(s) in the <tt class="docutils literal"><span class="pre">for</span></tt> loop(s).</p>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">ctypes.data:</th><td class="field-body"><p class="first last">The memory location of the first array element (but you should not worry about it)</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>An array also has convenience attributes, which can be derived from the previous ones:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">ndim:</th><td class="field-body">number of dimensions (or array&#8217;s rank, in NumPy wavering terminology)</td>
</tr>
<tr class="field-even field"><th class="field-name">size:</th><td class="field-body">number of elements</td>
</tr>
<tr class="field-odd field"><th class="field-name">itemsize:</th><td class="field-body">number of bytes of one element</td>
</tr>
<tr class="field-even field"><th class="field-name">nbytes:</th><td class="field-body">number of bytes of all elements</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">len</span></tt> function can be confusing when applied on arrays: it returns the number of elements along the first dimension only. It is better not to use it with arrays, and use <tt class="docutils literal"><span class="pre">.shape[0]</span></tt> instead for clarity.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>In Python (so it is also true for NumPy arrays), the assignation operator &#8216;=&#8217; does not make a copy. It adds a reference to the reference list of an object stored in memory. When the number of references drops to zero, the object will disappear and for arrays, the memory buffer will be released.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>So, to ensure that the arrays are different, you should explicitly make a copy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>In the same vein, here is the wrong way to assign 2 to all the elements of an array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([0, 1, 2, 3, 4])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">2</span>
</pre></div>
</div>
<p>The proper way to do it is:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([2, 2, 2, 2, 2])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-arrays">
<h1>Creating arrays<a class="headerlink" href="#creating-arrays" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">There are plenty of ways to create an array. The simplest one is to convert a Python list or tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="go">array([ 1.  ,  2.  ,  3.14,  4.  ])</span>
</pre></div>
</div>
<p>The data type of the resulting array is inferred from the types of the elements in the sequence, but it can be explicitly set with the <tt class="docutils literal"><span class="pre">dtype</span></tt> keyword:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<span class="go">array([1, 2, 3, 4], dtype=int8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="go">array([ 1.00+0.j,  2.00+0.j,  3.14+0.j,  4.00+0.j])</span>
</pre></div>
</div>
<p>Multi-dimensional arrays can be created using the same mechanism by nesting sequences, the innermost ones corresponding to the last dimension. Here is an example of a 2-by-3 array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="go">array([[1, 2, 3],</span>
<span class="go">       [1, 0, 1]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="go">array([1, 2, 3])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="go">array([1, 0, 1])</span>
</pre></div>
</div>
<p>Although it is cumbersome (we will see better ways to achieve that), a 4-by-1 array (a column) can be similarly created:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="go">array([[ 4],</span>
<span class="go">       [-1],</span>
<span class="go">       [ 2],</span>
<span class="go">       [ 0]])</span>
</pre></div>
</div>
</li>
<li><p class="first">Alternatively, when the array dimensions are known, the array can be allocated in memory and optionally filled with a particular value. The array may then be updated at a later stage.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">zeros:</th><td class="field-body"><p class="first">allocate a 0-filled array of given shape</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">array([[ 0.,  0.],</span>
<span class="go">       [ 0.,  0.]])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">ones:</th><td class="field-body"><p class="first">allocate a 1-filled array of given shape</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">array([[ 1.,  1.],</span>
<span class="go">       [ 1.,  1.]])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">full:</th><td class="field-body"><p class="first">allocate an array of given shape filled by a given value (NumPy 1.8)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="go">array([[ 3.14159265,  3.14159265],</span>
<span class="go">       [ 3.14159265,  3.14159265]])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">empty:</th><td class="field-body"><p class="first">allocate an array of given shape without initializing its values</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This function is much faster since to write to the memory is involved, but be careful to completely populate the array afterwards.</p>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, these functions return a <tt class="docutils literal"><span class="pre">float64</span></tt> array. To specify another data type, use the <tt class="docutils literal"><span class="pre">dtype</span></tt> keyword.</p>
</div>
</li>
<li><p class="first">It is possible to use another variable as a template to create a new array with the same data type and shape:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(dtype(&#39;int64&#39;), (2, 3))</span>
<span class="go">(dtype(&#39;int64&#39;), (2, 3))</span>
<span class="go">(dtype(&#39;int64&#39;), (2, 3))</span>
<span class="go">(dtype(&#39;int64&#39;), (2, 3))</span>
<span class="go">(dtype(&#39;int64&#39;), (2, 3))</span>
</pre></div>
</div>
</li>
<li><p class="first">Since discretization is at the heart of scientific computing, creation of grids has been made straightforward and it can be done in several ways:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">arange:</th><td class="field-body"><p class="first">Return evenly spaced values (the number of elements is known).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="go">array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span>
<span class="go">array([[ 1. ,  1.1,  1.2,  1.3,  1.4],</span>
<span class="go">       [ 1.5,  1.6,  1.7,  1.8,  1.9]])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">other calling sequences than <tt class="docutils literal"><span class="pre">start</span> <span class="pre">+</span> <span class="pre">np.arange(n)</span> <span class="pre">*</span> <span class="pre">step</span></tt> can be used with <tt class="docutils literal"><span class="pre">arange</span></tt>, but there are little compelling reasons to use them (see next function <tt class="docutils literal"><span class="pre">linspace</span></tt>).</p>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">linspace:</th><td class="field-body"><p class="first">Return evenly spaced values (the boundaries are known).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">array([ 2. ,  2.4,  2.8,  3.2,  3.6,  4. ])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">logspace:</th><td class="field-body"><p class="first">Return numbers evenly spaced on a log scale. By default the base 10 is used. The end points specify the base&#8217;s powers.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="go">array([ 1., 3.16227766, 10., 31.6227766, 100.])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">unlike Python&#8217;s <tt class="docutils literal"><span class="pre">range</span></tt> builtin, the last point of the interval is included by default in the array returned by <tt class="docutils literal"><span class="pre">linspace</span></tt> and <tt class="docutils literal"><span class="pre">logspace</span></tt>.</p>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">meshgrid:</th><td class="field-body"><p class="first">Return coordinate matrices from two or more coordinate vectors.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">nx</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ny</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x_1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y_1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x_2d</span><span class="p">,</span> <span class="n">yv_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_1d</span><span class="p">,</span> <span class="n">y_1d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x_2d</span>
<span class="go">array([[ 0. ,  0.5,  1. ],</span>
<span class="go">       [ 0. ,  0.5,  1. ]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y_2d</span>
<span class="go">array([[ 0.,  0.,  0.],</span>
<span class="go">       [ 1.,  1.,  1.]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_2d</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y_2d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="go">array([[ 0.        ,  0.5       ,  1.        ],</span>
<span class="go">       [ 1.        ,  1.11803399,  1.41421356]])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">mgrid:</th><td class="field-body"><p class="first">Return a dense multi-dimensional meshgrid.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Brackets are used and not parentheses.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4, 4), (4, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span>
<span class="go">array([[0, 0, 0, 0],</span>
<span class="go">       [1, 1, 1, 1],</span>
<span class="go">       [2, 2, 2, 2],</span>
<span class="go">       [3, 3, 3, 3]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span>
<span class="go">array([[0, 1, 2, 3],</span>
<span class="go">       [0, 1, 2, 3],</span>
<span class="go">       [0, 1, 2, 3],</span>
<span class="go">       [0, 1, 2, 3]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span>
<span class="go">array([[ 1.41421356,  1.        ,  1.41421356,  2.23606798],</span>
<span class="go">       [ 1.        ,  0.        ,  1.        ,  2.        ],</span>
<span class="go">       [ 1.41421356,  1.        ,  1.41421356,  2.23606798],</span>
<span class="go">       [ 2.23606798,  2.        ,  2.23606798,  2.82842712]])</span>
</pre></div>
</div>
<p>Another calling sequence specifies the bounds and the number of samples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="nb">complex</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="nb">complex</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span>
<span class="go">array([[ 0. ,  0. ,  0. ],</span>
<span class="go">       [ 0.5,  0.5,  0.5],</span>
<span class="go">       [ 1. ,  1. ,  1. ]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span>
<span class="go">array([[ 0. ,  0.5,  1. ],</span>
<span class="go">       [ 0. ,  0.5,  1. ],</span>
<span class="go">       [ 0. ,  0.5,  1. ]])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">ogrid:</th><td class="field-body"><p class="first">Return a sparse multi-dimensional meshgrid.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4, 1), (1, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span>
<span class="go">array([[0],</span>
<span class="go">       [1],</span>
<span class="go">       [2],</span>
<span class="go">       [3]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span>
<span class="go">array([[0, 1, 2, 3]])</span>
</pre></div>
</div>
<p>The sparse grid can be manipulated using <a class="reference internal" href="#section-broadcasting"><em>broadcasting</em></a> to achieve the same result as that of the dense grid:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span>
<span class="go">array([[ 1.41421356,  1.        ,  1.41421356,  2.23606798],</span>
<span class="go">       [ 1.        ,  0.        ,  1.        ,  2.        ],</span>
<span class="go">       [ 1.41421356,  1.        ,  1.41421356,  2.23606798],</span>
<span class="go">       [ 2.23606798,  2.        ,  2.23606798,  2.82842712]])</span>
</pre></div>
</div>
<p>Similarly to <tt class="docutils literal"><span class="pre">mgrid</span></tt>, an alternate calling sequence can be used:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="nb">complex</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="nb">complex</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span>
<span class="go">array([[ 0. ],</span>
<span class="go">       [ 0.5],</span>
<span class="go">       [ 1. ]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span>
<span class="go">array([[ 0. ,  0.5,  1. ]])</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Creation of arrays populated by pseudonumbers. The package <tt class="docutils literal"><span class="pre">numpy.random</span></tt> contains pseudonumber generators for the usual distributions. Many more are available in <tt class="docutils literal"><span class="pre">scipy.stats</span></tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">random_itegers:</th><td class="field-body"><p class="first">Return random integers between a lower and upper value, inclusive.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="docutils literal"><span class="pre">randint</span></tt> also exists. It doesn&#8217;t do anything that <tt class="docutils literal"><span class="pre">random_integers</span></tt> cannot, except confusing the user. Stick with <tt class="docutils literal"><span class="pre">random_integers</span></tt>, which has a better name.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even if a default value exists for the lower value, it is better practice to specify both the lower and upper values (<tt class="docutils literal"><span class="pre">randint</span></tt> has not the same default value, so don&#8217;t bother memorizing it).</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">array([[5, 2],</span>
<span class="go">       [3, 6],</span>
<span class="go">       [1, 6]])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">random_sample:</th><td class="field-body"><p class="first">Return uniformly distributed random floats in the half-open interval [0.0, 1.0).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">for the only purpose of confusing users even more, this function has 3 aliases <tt class="docutils literal"><span class="pre">random</span></tt>, <tt class="docutils literal"><span class="pre">randf</span></tt> and <tt class="docutils literal"><span class="pre">sample</span></tt>! Avoid them. And there&#8217;s also <tt class="docutils literal"><span class="pre">rand</span></tt>, see note below.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">array([[ 0.55442892,  0.97919858],</span>
<span class="go">       [ 0.40742057,  0.00879652],</span>
<span class="go">       [ 0.098388836,  0.67112335]])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">standard_nomal:</th><td class="field-body"><p class="first">Return random floats from the standard normal distribution.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">array([[ 1.72573865,  0.8938781 ],</span>
<span class="go">       [ 0.37971588, -0.40010123],</span>
<span class="go">       [-0.33761754,  0.07175398]])</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">I prefer not to use MATLAB® equivalent shortcuts <tt class="docutils literal"><span class="pre">rand</span></tt> (for <tt class="docutils literal"><span class="pre">random_sample</span></tt>) and <tt class="docutils literal"><span class="pre">randn</span></tt> (for <tt class="docutils literal"><span class="pre">standard_normal</span></tt>), even if they are conveniently available in <tt class="docutils literal"><span class="pre">numpy</span></tt>&#8216;s module namespace. Their calling sequence <tt class="docutils literal"><span class="pre">rand(d0,</span> <span class="pre">d1,</span> <span class="pre">...)</span></tt> is inconsistent with most other NumPy functions such as <tt class="docutils literal"><span class="pre">zeros</span></tt>, <tt class="docutils literal"><span class="pre">ones</span></tt>, <tt class="docutils literal"><span class="pre">random_integers</span></tt>, <tt class="docutils literal"><span class="pre">random_sample</span></tt>, <tt class="docutils literal"><span class="pre">standard_normal</span></tt>, <tt class="docutils literal"><span class="pre">standard_cauchy</span></tt> etc., which take a tuple as first argument to specify the array shape.</p>
</div>
</li>
</ul>
</div>
<div class="section" id="basic-operations">
<h1>Basic operations<a class="headerlink" href="#basic-operations" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">Functions in NumPy are vectorized</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">np.sum:</th><td class="field-body">sum of elements</td>
</tr>
<tr class="field-even field"><th class="field-name">np.cumsum:</th><td class="field-body">cumulative sum of elements</td>
</tr>
<tr class="field-odd field"><th class="field-name">np.product:</th><td class="field-body">product of elements</td>
</tr>
<tr class="field-even field"><th class="field-name">np.cumproduct:</th><td class="field-body">cumulative product of elements</td>
</tr>
<tr class="field-odd field"><th class="field-name">np.sort:</th><td class="field-body">sort elements</td>
</tr>
<tr class="field-even field"><th class="field-name">np.argsort:</th><td class="field-body">return the indices that would sort an array</td>
</tr>
<tr class="field-odd field"><th class="field-name">np.all:</th><td class="field-body">return True if all array elements evaluate to True</td>
</tr>
<tr class="field-even field"><th class="field-name">np.any:</th><td class="field-body">return True if any array element evaluates to True</td>
</tr>
<tr class="field-odd field"><th class="field-name">np.min:</th><td class="field-body">return the minimum element of an array</td>
</tr>
<tr class="field-even field"><th class="field-name">np.max:</th><td class="field-body">return the maximum element of an array</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Python builtin functions <tt class="docutils literal"><span class="pre">all</span></tt>, <tt class="docutils literal"><span class="pre">any</span></tt>, <tt class="docutils literal"><span class="pre">min</span></tt> and <tt class="docutils literal"><span class="pre">max</span></tt> should not be used with NumPy arrays since 1) they are slow and 2) they will not work on multi-dimensional arrays.</p>
</div>
<p>With these functions, an axis can be specified: it is the axis that will be collapsed and along which the operation is performed.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">[[0 1 2 3]</span>
<span class="go"> [4 5 6 7]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="go">[ 4  6  8 10]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="go">[ 6 22]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">axes can be specified by starting from the last one, using negative values. <tt class="docutils literal"><span class="pre">-1</span></tt> stands for the last axis, <tt class="docutils literal"><span class="pre">-2</span></tt> for the last but one.</p>
</div>
</li>
<li><p class="first">Most common operations with two operands are performed element-wise:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>              <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>              <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
<span class="go">array([[ 0,  2,  0],</span>
<span class="go">       [ 6,  9, 12]])</span>
</pre></div>
</div>
</li>
<li><p class="first">Boolean operations.</p>
<p>The operators <tt class="docutils literal"><span class="pre">not</span></tt>, <tt class="docutils literal"><span class="pre">and</span></tt> and <tt class="docutils literal"><span class="pre">or</span></tt> should not be used with arrays.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="4%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>not</td>
<td>→</td>
<td><tt class="docutils literal"><span class="pre">~</span></tt> or <tt class="docutils literal"><span class="pre">logical_not</span></tt></td>
</tr>
<tr class="row-even"><td>and</td>
<td>→</td>
<td><tt class="docutils literal"><span class="pre">&amp;</span></tt> or <tt class="docutils literal"><span class="pre">logical_and</span></tt></td>
</tr>
<tr class="row-odd"><td>or</td>
<td>→</td>
<td><tt class="docutils literal"><span class="pre">|</span></tt> or <tt class="docutils literal"><span class="pre">logical_or</span></tt></td>
</tr>
<tr class="row-even"><td>xor</td>
<td>→</td>
<td><tt class="docutils literal"><span class="pre">^</span></tt> or <tt class="docutils literal"><span class="pre">logical_xor</span></tt></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The operators <tt class="docutils literal"><span class="pre">~</span></tt>, <tt class="docutils literal"><span class="pre">&amp;</span></tt>, <tt class="docutils literal"><span class="pre">|</span></tt> and <tt class="docutils literal"><span class="pre">^</span></tt> have a very high priority, so parenthesis must be used to combine expressions. The following example shows how to print the number of times that 1 or 10 are drawn from a uniform distribution:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">10</span><span class="p">))</span>
<span class="go">207</span>
</pre></div>
</div>
</div>
</li>
</ul>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>: Computation of <img class="math" src="_images/math/c1bd4cb4e3647c6b2356b7ccf2f52aeffedd1b61.png" alt="\pi"/> by Monte-Carlo sampling.</p>
<p>Given the random variables X and Y following the uniform distribution between -1 and 1, the probability for the point (X, Y) to be inside the unity disk is the ratio of the surface of the unity disk and that of the unity square, i.e. <img class="math" src="_images/math/e6bb193313c6dd69aea0a65814c37c3c8522a0f7.png" alt="\pi/4"/>. It is then possible possible to compute <img class="math" src="_images/math/c1bd4cb4e3647c6b2356b7ccf2f52aeffedd1b61.png" alt="\pi"/> by drawing realizations of X and Y and counting the fraction of points (X, Y) inside the unity disk.</p>
<p>Vectorize the following pure Python code, by using NumPy arrays and functions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">NTOTAL</span> <span class="o">=</span> <span class="mi">1000000</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ninside</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">NTOTAL</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ninside</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span>
<span class="n">pi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">ninside</span> <span class="o">/</span> <span class="n">NTOTAL</span>

<span class="k">print</span> <span class="n">pi</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
</pre></div>
</div>
<p>[<a class="reference internal" href="auto_examples/pi_montecarlo.html#pi-montecarlo-py"><em>Solution</em></a>]</p>
</div>
</div>
<div class="section" id="indexing-arrays">
<h1>Indexing arrays<a class="headerlink" href="#indexing-arrays" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">integers and slices: like Python</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">indexing starts at 0!</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">in slices, the stop point is excluded from the selection!</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">negative indices are fine.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="go">array([3, 4, 5, 6])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
<span class="go">array([0, 2, 4, 6, 8])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span> <span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(8,), (16,)</span>
</pre></div>
</div>
</li>
<li><p class="first">The ellipsis <tt class="docutils literal"><span class="pre">...</span></tt> replaces as many <tt class="docutils literal"><span class="pre">:</span></tt> as possible. For an array <tt class="docutils literal"><span class="pre">a</span></tt> of rank 4: <tt class="docutils literal"><span class="pre">a[...,</span> <span class="pre">0,</span> <span class="pre">:]</span></tt> is equivalent to <tt class="docutils literal"><span class="pre">a[:,</span> <span class="pre">:,</span> <span class="pre">0,</span> <span class="pre">:]</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 3, 4)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="docutils literal"><span class="pre">a[i]</span></tt> is equivalent to <tt class="docutils literal"><span class="pre">a[i,</span> <span class="pre">...]</span></tt></p>
</div>
</li>
<li><p class="first">A boolean array can be used as a mask to select elements.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use boolean masks instead of the <tt class="docutils literal"><span class="pre">where</span></tt> function!</p>
</div>
</li>
<li><p class="first">selection indexing: an integer array can also be used</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">[:</span><span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
</ul>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>: Array creation</p>
<p>Create the following 1-dimensional arrays:</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/df1491e216ef6fc35fd351a0180f05bc37d72439.png" alt="a_1 &amp;= [\underbrace{0\,0\,0 \cdots 0}_{N\ \rm times}\;\underbrace{1\,1 \cdots 1}_{N-1\ \rm times}\;\underbrace{2 \cdots 2}_{N-2\ \rm times}\;\cdots\;N-2\;N-2\;N-1] \\
a_2 &amp;= [0\,1 \cdots N-1\quad 0\,1 \cdots N-2\;\cdots\;0\,1\,2\;0\,1\;0]"/></p>
</div></div></blockquote>
<p>[<a class="reference internal" href="auto_examples/array_creation.html#array-creation-py"><em>Solution</em></a>]</p>
</div>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>: Histogram</p>
<p>Complete the missing parts of the code below to do this exercise.
Given a large number of particules of velocities <img class="math" src="_images/math/d6838c7e8f493e142abba75cd9bd1646a55b60ab.png" alt="v_x, v_y, v_z"/> distributed according to the standard normal distribution, plot the histogram of the speed in 1, 2 and 3 dimensions:</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/66b605b6a9390d82a86ad01556be7a336e592b86.png" alt="v_1 &amp;= |v_x| = \sqrt{v_x^2} \\
v_2 &amp;= \sqrt{v_x^2+v_y^2} \\
v_3 &amp;= \sqrt{v_x^2+v_y^2+v_z^2}"/></p>
</div></div></blockquote>
<p>and compare it to the theoretical Maxwell distributions:</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/a7bc6a791d2f4f4f6c2ef8f387f8ee455461a9ef.png" alt="f_n(v) = \left(\frac{\pi}{2}\right)^{-\frac{|n-2|}{2}} v^{n-1} e^{-\frac{1}{2}v^2}"/></p>
</div></div></blockquote>
<p>where <img class="math" src="_images/math/413f8a8e40062a9090d9d50b88bc7b551b314c26.png" alt="n"/> = 1, 2, 3 is the number of dimensions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">mp</span>


<span class="k">def</span> <span class="nf">velocity2speed</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">ndims</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return the ndims-dimensional speed of the particles. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">...</span>


<span class="k">def</span> <span class="nf">speed_distribution</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">ndims</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the probability distribution function of the ndims-dimensional</span>
<span class="sd">    speed of the particles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">...</span>


<span class="n">NPARTICULES</span> <span class="o">=</span> <span class="mi">1000000</span>

<span class="n">velocity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="n">NPARTICULES</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ndims</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">velocity2speed</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ndims</span><span class="p">)</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;{}-d speed distribution&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ndims</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;speed&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">mp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference internal" href="auto_examples/plot_maxwell.html#plot-maxwell-py"><em>Solution</em></a>]</p>
</div>
</div>
<div class="section" id="manipulating-arrays">
<h1>Manipulating arrays<a class="headerlink" href="#manipulating-arrays" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">Transformations that change the shape but not the size</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">.reshape:</th><td class="field-body"><p class="first">Give a new shape.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>One shape dimension can be -1. In this case, the value is inferred from the number of elements of the array and the remaining dimensions.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4, 14)</span>
</pre></div>
</div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">.ravel:</th><td class="field-body"><p class="first">Flatten an array to one dimension.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, in the <tt class="docutils literal"><span class="pre">reshape</span></tt> and <tt class="docutils literal"><span class="pre">ravel</span></tt> transformations, the elements of the input and output array are identical when both travelled along the row-major order.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">.ravel</span></tt> method will attempt to return a view of the array, but if the elements of the array cannot be travelled using a constant stride, a copy will be returned. The <tt class="docutils literal"><span class="pre">.flatten</span></tt> method is similar, but always returns a copy and should therefore be used less frequently.</p>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">.T:</th><td class="field-body"><p class="first">Transpose of the array.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">.swapaxes:</th><td class="field-body"><p class="first">Interchange two axes.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">np.rollaxis:</th><td class="field-body"><p class="first">Roll a specified axis backwards, until it lies in a given position.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">.squeeze:</th><td class="field-body"><p class="first last">Remove single-dimensional entries from the shape of the array.</p>
</td>
</tr>
</tbody>
</table>
<p>It is also easy to add a new dimension, using <tt class="docutils literal"><span class="pre">None</span></tt> (or equivalently <tt class="docutils literal"><span class="pre">np.newaxis</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 5, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 1, 5)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1, 3, 5)</span>
</pre></div>
</div>
<p>We will see later how much this notation can be handy when used in conjonction with broadcasting.</p>
</li>
<li><p class="first">Transformations that change the size</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">np.resize:</th><td class="field-body">Return a new array with the specified shape, repeating the array if necessary</td>
</tr>
<tr class="field-even field"><th class="field-name">tile:</th><td class="field-body">Construct an array by repeating A the given number of times.</td>
</tr>
<tr class="field-odd field"><th class="field-name">resize:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">repeat:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>:</p>
<p>Write a function that returns the mean of each 100 element block of a vector of size 100×N. The first version will loop over the vector slices by using a list comprehension and the second one will use NumPy transformation functions to avoid the <tt class="docutils literal"><span class="pre">for</span></tt> loop. The vector elements will be drawn from any statistical distribution.</p>
<p>[<a class="reference internal" href="auto_examples/block_mean.html#block-mean-py"><em>Solution</em></a>]</p>
</div>
</div>
<div class="section" id="views-and-copies">
<h1>Views and copies<a class="headerlink" href="#views-and-copies" title="Permalink to this headline">¶</a></h1>
<p>A powerful aspect of NumPy&#8217;s array model is that many operations can be performed without copying the data, which can be expensive especially when handling big datasets. For instance, indexing using a slice returns a view on the initial array, which mean that the initial and sliced arrays share the same memory buffer. This is a frequent source a confusion, since modifying the view will affect the original array. It is then important to know which operations return a view and which ones a copy. A view on an array is different from a reference: even though they share the same memory buffer, the viewing and viewed arrays are different Python objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>:</p>
<p>Given the function</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">isview</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    Return True if b is a view on a.</span>
<span class="gp">... </span><span class="sd">    (It is assumed that a&#39;s memory buffer is contiguous)</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">nbytes</span>
</pre></div>
</div>
<p>and the array</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>let&#8217;s first check that slicing an array does not copy it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">isview</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Then, check what the following actions do and whether their result is a view or a copy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">a</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">a</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">view</span><span class="p">([(</span><span class="s">&#39;position&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;mass&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)])</span>
<span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
<span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">T</span>
<span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="combining-arrays">
<h1>Combining arrays<a class="headerlink" href="#combining-arrays" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">r_:</th><td class="field-body"><p class="first">Translate slice objects to concatenation along the first axis.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])]</span>
<span class="go">array([1, 2, 3, 0, 0, 4, 5, 6])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">hstack:</th><td class="field-body"><p class="first">Stack arrays in sequence horizontally (column wise).</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">vstack:</th><td class="field-body"><p class="first">Stack arrays in sequence vertically (row wise).</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">dstack:</th><td class="field-body"><p class="first">Stack arrays in sequence depth wise (along third axis).</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">concatenate:</th><td class="field-body"><p class="first">Join a sequence of arrays together.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">column_stack:</th><td class="field-body"><p class="first">Stack 1-D arrays as columns into a 2-D array.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">row_stack:</th><td class="field-body"><p class="first last">Stack arrays in sequence vertically (row wise).</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="broadcasting">
<span id="section-broadcasting"></span><h1>Broadcasting<a class="headerlink" href="#broadcasting" title="Permalink to this headline">¶</a></h1>
<p>Broadcasting allows operations (such as addition, multiplication etc.) which are normally element-wise to be carried on arrays of different shapes. It is a virtual replication of the arrays along the missing dimensions. It can be seen as a generalization of operations involving an array and a scalar.</p>
<ul class="simple">
<li>the addition of a scalar on an matrix can be seen as the addition of a matrix with identical elements (and same dimensions).</li>
</ul>
<img alt="_images/broadcast_scalar.png" src="_images/broadcast_scalar.png" />
<ul class="simple">
<li>the addition of a row on a matrix will be seen as the addition of a matrix with replicated rows (the number of columns must match).</li>
</ul>
<img alt="_images/broadcast_row.png" src="_images/broadcast_row.png" />
<ul class="simple">
<li>conversely the addition of a column on a matrix will be seen as the addition of a matrix with replicated columns (the number of rows must match)</li>
</ul>
<img alt="_images/broadcast_column.png" src="_images/broadcast_column.png" />
<ul>
<li><p class="first">What if the rank of the arrays is greater than 2? There is no restriction on the rank: any dimension of length 1 is broadcastable and is virtually replicated to match the other array&#8217;s dimension length. The two arrays may have different broadcastable dimensions. If this happens, the result of the operation will have more elements than any of the operands.</p>
</li>
<li><p class="first">Can it work on arrays of different ranks? Sure! Dimensions of length 1 are <strong>prepended</strong> (added on the left of the array shape) until the two arrays have the same rank. As a consequence, the following operation is possible:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
<p>but not this one, since the righmost dimensions are different:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">ValueError: operands could not be broadcast together with shapes (5,9) (5)</span>
</pre></div>
</div>
<p>So for columns, an additional dimension must be specified and added on the right:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first">Can it work on more than two arrays? Yes again! But you have to find an element-wise operation with more than two operands...</p>
</li>
<li><p class="first">Since the replication is virtual, no memory is wasted. Broadcasting is fast. Use it wherever possible, just keep an eye on the size of the broadcast result to make sure that it does not become too large.</p>
</li>
</ul>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>:</p>
<p>Can the arrays of the following shapes be broadcast together? If yes, what would be the shape of the result?</p>
<ul class="simple">
<li>(7, 1) and (7, 4)</li>
<li>(7,) and (4, 7)</li>
<li>(3, 3) and (2, 3)</li>
<li>(1, 1, 1, 8) and (1, 9, 1)</li>
<li>(4, 1, 9) and (3, 1)</li>
</ul>
<p>[<a class="reference internal" href="auto_examples/broadcasting_shapes.html#broadcasting-shapes"><em>Solution</em></a>]</p>
</div>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>:</p>
<p>Remove the <tt class="docutils literal"><span class="pre">for</span></tt> loops in this code by using broadcasting and measure the improvement in execution time.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">NDETECTORS</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">NSAMPLES</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">SAMPLING_PERIOD</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">GLITCH_TAU</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">GLITCH_AMPL</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">GAIN_SIGMA</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">SOURCE_AMPL</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">SOURCE_PERIOD</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">NOISE_SIGMA</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">NSAMPLES</span><span class="p">)</span> <span class="o">*</span> <span class="n">SAMPLING_PERIOD</span>
<span class="n">glitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NSAMPLES</span><span class="p">)</span>
<span class="n">glitch</span><span class="p">[</span><span class="mi">100</span><span class="p">:]</span> <span class="o">=</span> <span class="n">GLITCH_AMPL</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">time</span><span class="p">[:</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span> <span class="o">/</span> <span class="n">GLITCH_TAU</span><span class="p">)</span>
<span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">GAIN_SIGMA</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">NDETECTORS</span><span class="p">)</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">NDETECTORS</span><span class="p">)</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">SOURCE_AMPL</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">time</span> <span class="o">/</span> <span class="n">SOURCE_PERIOD</span><span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">NOISE_SIGMA</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="n">NDETECTORS</span><span class="p">,</span> <span class="n">NSAMPLES</span><span class="p">))</span>

<span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">NDETECTORS</span><span class="p">,</span> <span class="n">NSAMPLES</span><span class="p">))</span>
<span class="k">for</span> <span class="n">idet</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">NDETECTORS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">isample</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">NSAMPLES</span><span class="p">):</span>
        <span class="n">signal</span><span class="p">[</span><span class="n">idet</span><span class="p">,</span> <span class="n">isample</span><span class="p">]</span> <span class="o">=</span> <span class="n">gain</span><span class="p">[</span><span class="n">idet</span><span class="p">]</span> <span class="o">*</span> <span class="n">source</span><span class="p">[</span><span class="n">isample</span><span class="p">]</span> <span class="o">+</span> \
                                <span class="n">glitch</span><span class="p">[</span><span class="n">isample</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">[</span><span class="n">idet</span><span class="p">]</span> <span class="o">+</span> \
                                <span class="n">noise</span><span class="p">[</span><span class="n">idet</span><span class="p">,</span> <span class="n">isample</span><span class="p">]</span>

<span class="n">mp</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">mp</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="s">&#39;211&#39;</span><span class="p">)</span>
<span class="n">mp</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="n">mp</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;sample&#39;</span><span class="p">)</span>
<span class="n">mp</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;detector&#39;</span><span class="p">)</span>
<span class="n">mp</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="s">&#39;212&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">signal</span><span class="p">:</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="n">mp</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;time [s]&#39;</span><span class="p">)</span>
<span class="n">mp</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;signal&#39;</span><span class="p">)</span>
<span class="n">mp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference internal" href="auto_examples/plot_broadcasting.html#plot-broadcasting-py"><em>Solution</em></a>]</p>
</div>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>:</p>
<p>Write a one-liner function that normalizes by the euclidian norm M N-dimensional real vectors packed in an array of shape (M, N).</p>
<p>[<a class="reference internal" href="auto_examples/normalize.html#normalize-py"><em>Solution</em></a>]</p>
</div>
</div>
<div class="section" id="universal-functions-ufuncs">
<h1>Universal functions (Ufuncs)<a class="headerlink" href="#universal-functions-ufuncs" title="Permalink to this headline">¶</a></h1>
<p>Arrays and universal functions are the two fundamental NumPy building blocks. The most basic operations on arrays are performed by these ufuncs.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operator</th>
<th class="head">Ufunc</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">+</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.add</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.subtract</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">*</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.multiply</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">/</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.true_divide</span></tt> (with: <tt class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">division</span></tt>)</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">//</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.floor_divide</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">**</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.power</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">%</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.mod</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">==</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.equal</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">!=</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.not_equal</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&lt;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.less</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&lt;=</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.less_equal</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&gt;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.greater</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&gt;=</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.greater_equal</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">~</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.logical_not</span></tt> or <tt class="docutils literal"><span class="pre">np.bitwise_not</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&amp;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.logical_and</span></tt> or <tt class="docutils literal"><span class="pre">np.bitwise_and</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">|</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.logical_or</span></tt>  or <tt class="docutils literal"><span class="pre">np.bitwise_or</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">^</span></tt></td>
<td><tt class="docutils literal"><span class="pre">np.logical_xor</span></tt> or <tt class="docutils literal"><span class="pre">np.bitwise_xor</span></tt></td>
</tr>
</tbody>
</table>
<p><a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/ufuncs.html#available-ufuncs">Many functions</a> are also implemented as ufuncs: <tt class="docutils literal"><span class="pre">absolute</span></tt>, <tt class="docutils literal"><span class="pre">conj</span></tt>, <tt class="docutils literal"><span class="pre">sign</span></tt>, <tt class="docutils literal"><span class="pre">cos</span></tt>, <tt class="docutils literal"><span class="pre">sin</span></tt>, <tt class="docutils literal"><span class="pre">tan</span></tt>, <tt class="docutils literal"><span class="pre">arccos</span></tt>, <tt class="docutils literal"><span class="pre">arcsin</span></tt>, <tt class="docutils literal"><span class="pre">arctan2</span></tt> and many more...</p>
<p>A <tt class="docutils literal"><span class="pre">ufunc</span></tt> has the following characteritics:</p>
<ol class="arabic">
<li><p class="first">a buffer can be provided for the output, which can be useful to avoid temporaries.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">timeit</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span>
<span class="go">10 loops, best of 3: 45 ms per loop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">timeit</span> <span class="k">global</span> <span class="n">out</span><span class="p">;</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">);</span> <span class="n">out</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">out</span> <span class="o">+=</span> <span class="n">x</span>
<span class="go">10 loops, best of 3: 37 ms per loop</span>
</pre></div>
</div>
</li>
<li><p class="first">it implements the broadcasting mechanism on its inputs and outputs.</p>
</li>
<li><p class="first">it has the following methods (which are only useful for ufuncs with two arguments):</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">reduce:</th><td class="field-body"><p class="first">reduce <cite>a</cite> to a scalar or <cite>a</cite>&#8216;s dimension by one, by applying the <tt class="docutils literal"><span class="pre">ufunc</span></tt> along all axes or one specified axis. Equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">r</span> <span class="o">=</span> <span class="n">ufunc</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">accumulate:</th><td class="field-body"><p class="first">accumulate the result of applying the <tt class="docutils literal"><span class="pre">ufunc</span></tt> to all elements. Equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ufunc</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">outer:</th><td class="field-body"><p class="first">outer product equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
<span class="gp">... </span>        <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ufunc</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</pre></div>
</div>
<p>Example: the truth table of logical operators can be obtained straightforwardly using this method.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tf</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span>
<span class="go">array([[ True, False],</span>
<span class="go">       [False, False]], dtype=bool)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span>
<span class="go">array([[ True,  True],</span>
<span class="go">       [ True, False]], dtype=bool)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ol>
<p>The use of ufuncs in NumPy is pervasive and the following non-ufunc functions, which are amongst the most basic ones, are using internally the ufunc methods that we have just described:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Under the hood</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>np.sum</td>
<td>np.add.reduce</td>
</tr>
<tr class="row-odd"><td>np.cumsum</td>
<td>np.add.accumulate</td>
</tr>
<tr class="row-even"><td>np.product</td>
<td>np.multiply.reduce</td>
</tr>
<tr class="row-odd"><td>np.cumproduct</td>
<td>np.multiply.accumulate</td>
</tr>
<tr class="row-even"><td>np.min</td>
<td>np.minimum.reduce</td>
</tr>
<tr class="row-odd"><td>np.max</td>
<td>np.maximum.reduce</td>
</tr>
<tr class="row-even"><td>np.any</td>
<td>np.logical_or.reduce</td>
</tr>
<tr class="row-odd"><td>np.all</td>
<td>np.logical_and.reduce</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>It is relatively easy to write ufuncs in C.</p>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>:</p>
<p>Using ufunc capabilities, create <img class="math" src="_images/math/be03d37abd791d40059574c12ee4774f06d3d91d.png" alt="M\times N"/> matrices <img class="math" src="_images/math/0acafa529182e79b4f56165ec677554fba7fcf98.png" alt="A"/> and <img class="math" src="_images/math/83956e92fcc80dee17fce864543216939a3c9da7.png" alt="B"/> such that</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/75127747d5528cea286211a5482da927fea6701c.png" alt="A_{ij} &amp;= i + j \\
B_{ij} &amp;= ij"/></p>
</div></div></blockquote>
<p>with <img class="math" src="_images/math/459bc457a3207fcd21fa637505ec3345b09337b1.png" alt="0\le i&lt;M"/> and  <img class="math" src="_images/math/8c70a73e313ee1f872ce534811b0ae63278b8c65.png" alt="0\le j&lt;N"/></p>
<p>[<a class="reference internal" href="auto_examples/ufunc_matrices.html#ufunc-matrices-py"><em>Solution</em></a>]</p>
</div>
</div>
<div class="section" id="special-values">
<h1>Special values<a class="headerlink" href="#special-values" title="Permalink to this headline">¶</a></h1>
<p>NumPy supports IEEE 754 floating point special values <cite>NaN</cite> and <cite>inf</cite>. These literal values are available as <tt class="docutils literal"><span class="pre">np.nan</span></tt> and <tt class="docutils literal"><span class="pre">np.inf</span></tt> and are stored as Python <tt class="docutils literal"><span class="pre">float</span></tt>.</p>
<p>NumPy&#8217;s behaviour when an IEEE exception occurs is configurable with the <tt class="docutils literal"><span class="pre">seterr</span></tt> function. If your code produces NaNs, you can raise exceptions when NaN are triggered to know where the problem happens:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s">&#39;raise&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To inspect these special values:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">isinf:</th><td class="field-body"><p class="first">Return True for positive or negative infinite numbers</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">isnan:</th><td class="field-body"><p class="first">Return True for NaN elements</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="p">((</span><span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)))</span>
<span class="go">True</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">isfinite:</th><td class="field-body"><p class="first last">Return True for finite elements (non-infinite and non-NaN)</p>
</td>
</tr>
</tbody>
</table>
<p>And to make them non-special:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">nan_to_num:</th><td class="field-body">Set <cite>NaN</cite> to zero, <cite>+inf</cite> to max float and <cite>-inf</cite> to min float</td>
</tr>
</tbody>
</table>
<p>When NaN values are present in an array, most NumPy functions will propagate them to the result instead of restricting the operation to the non-NaN elements. To explicitly discard the NaNs, one should call the following functions: <tt class="docutils literal"><span class="pre">nanmin</span></tt>, <tt class="docutils literal"><span class="pre">nanmax</span></tt>, <tt class="docutils literal"><span class="pre">nanargmin</span></tt>, <tt class="docutils literal"><span class="pre">nanargmax</span></tt>, <tt class="docutils literal"><span class="pre">nanmean</span></tt>, <tt class="docutils literal"><span class="pre">nanstd</span></tt>, <tt class="docutils literal"><span class="pre">nanvar</span></tt>, <tt class="docutils literal"><span class="pre">nansum</span></tt>.</p>
</div>
<div class="section" id="structured-data-types">
<span id="section-structured-dtype"></span><h1>Structured data types<a class="headerlink" href="#structured-data-types" title="Permalink to this headline">¶</a></h1>
<p>Basic data types can be combined to form structured data types, akin to C&#8217;s <tt class="docutils literal"><span class="pre">struct</span></tt> or Fortran&#8217;s derived types. The synthax to create such records is strict, it must be a <strong>list</strong> of <strong>tuples</strong>, each tuple containing the name, data type and optionally the shape of the field. The field values are accessed by using brackets enclosing the field names.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">point_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">point_dtype</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">points</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">points</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">points</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.1620762355727834, 0.2395019980532217, 0.9167745701692562)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">points</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Another example, in which the shapes of the fields are specified:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">spectra_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;fluxdensity&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
<span class="gp">... </span>                 <span class="p">(</span><span class="s">&#39;wavelength&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">spectra_dtype</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span><span class="p">[</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
<span class="go">100</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Fields can be strings, but since array elements must have a fixed common <tt class="docutils literal"><span class="pre">itemsize</span></tt>, it is mandatory to specify the maximum number of characters. Structured data types can also be combined together:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;S256&#39;</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="s">&#39;pos&#39;</span><span class="p">,</span> <span class="n">point_dtype</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">galaxy_dtype</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;M81&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
<span class="go">&#39;M81&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;pos&#39;</span><span class="p">][</span><span class="s">&#39;x&#39;</span><span class="p">],</span> <span class="n">galaxy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;pos&#39;</span><span class="p">][</span><span class="s">&#39;y&#39;</span><span class="p">],</span> <span class="n">galaxy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;pos&#39;</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">]</span>
<span class="go">(1.0, -1.0, 0.0)</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Indexing using boolean or integer arrays makes a copy. In the following expression, a temporary structured array is created to store <tt class="docutils literal"><span class="pre">galaxy[[0,</span> <span class="pre">1]]</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;new name 1&#39;</span><span class="p">,</span> <span class="s">&#39;new name 2&#39;</span>
</pre></div>
</div>
<p>and this is where the update of the field <tt class="docutils literal"><span class="pre">name</span></tt> takes place. As a consequence, the original array is left intact:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">galaxy</span><span class="p">[:</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
<span class="go">[&#39;M81&#39; &#39;&#39;]</span>
</pre></div>
</div>
<p>To circumvent this potential source of mistakes using boolean and integer arrays, the indexing should be performed rightmost:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="s">&#39;new name 1&#39;</span><span class="p">,</span> <span class="s">&#39;new name 2&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">galaxy</span><span class="p">[:</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Note that using integers or slices for indexing does not make a copy, so rightmost indexing is not required in these cases:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy</span><span class="p">[:</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;galaxy 1&#39;</span><span class="p">,</span> <span class="s">&#39;galaxy 2&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">galaxy</span><span class="p">[:</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
<span class="go">[&#39;galaxy 1&#39; &#39;galaxy 2&#39;]</span>
</pre></div>
</div>
</div>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong>: Indirect sort.</p>
<p>An indirect sort consists in using an array to sort another one.</p>
<p>First, create a structured dtype with a string field <tt class="docutils literal"><span class="pre">name</span></tt> (no more than 10 characters) and an integer field <tt class="docutils literal"><span class="pre">age</span></tt>. Then use it to allocate a large array of people. The <tt class="docutils literal"><span class="pre">name</span></tt> field will be populated with <tt class="docutils literal"><span class="pre">id1</span></tt>, <tt class="docutils literal"><span class="pre">id2</span></tt>, etc. and the <tt class="docutils literal"><span class="pre">age</span></tt> field according to any random distribution. Sort the people according to their age by two methods: 1) using the function <tt class="docutils literal"><span class="pre">np.argsort</span></tt> and 2) looking at the <tt class="docutils literal"><span class="pre">np.sort</span></tt> documentation related to structured arrays.</p>
<p>[<a class="reference internal" href="auto_examples/indirect_sort.html#indirect-sort-py"><em>Solution</em></a>]</p>
</div>
</div>
<div class="section" id="record-arrays">
<h1>Record arrays<a class="headerlink" href="#record-arrays" title="Permalink to this headline">¶</a></h1>
<p>Accessing fields in structured arrays by using brackets can be a bit clumsy. Fortunately, it is possible to access these fields in a more concise way, as attributes, by using record arrays. It can be done in the following way (field values are not initialized):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">source_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;S256&#39;</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="s">&#39;ra&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="s">&#39;dec&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">recarray</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">source_dtype</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;M81&#39;</span><span class="p">,</span> <span class="mf">148.8882208</span><span class="p">,</span> <span class="mf">69.0652947</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
<span class="go">(&#39;M81&#39;, 148.8882208, 69.065294699999995)</span>
</pre></div>
</div>
<p>An existing structured array can be viewed as a <tt class="docutils literal"><span class="pre">recarray</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">source</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">source_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">recarray</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;M81&#39;</span><span class="p">,</span> <span class="mf">148.8882208</span><span class="p">,</span> <span class="mf">69.0652947</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>... but attribute access is broken for scalars (NumPy 1.8):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">AttributeError: &#39;numpy.void&#39; object has no attribute &#39;name&#39;</span>
</pre></div>
</div>
<p>So one should write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;M81&#39;</span>
</pre></div>
</div>
<p class="last">And even for record arrays obtained with the <tt class="docutils literal"><span class="pre">np.recarray</span></tt> constructor, attribute access is broken (NumPy 1.8) for scalars with nested data types (write <tt class="docutils literal"><span class="pre">galaxy.pos.x[0]</span></tt> instead of <tt class="docutils literal"><span class="pre">galaxy[0].pos.x</span></tt> as well).</p>
</div>
</div>
<div class="section" id="dense-linear-algebra">
<h1>Dense linear algebra<a class="headerlink" href="#dense-linear-algebra" title="Permalink to this headline">¶</a></h1>
<p>Although a specific class (<tt class="docutils literal"><span class="pre">matrix</span></tt>) does exist to facilitate matrix handling (the signs <tt class="docutils literal"><span class="pre">*</span></tt> and <tt class="docutils literal"><span class="pre">**</span></tt> have been redefined to mean matrix multiplication and power), it is seldom used in practice, the reason being that it is more frequent to deal with arrays of dimensions larger than two.</p>
<p>In the NumPy name space:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">dot:</th><td class="field-body"><p class="first">Vector-vector, matrix-vector or matrix-matrix dot product</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>1-dimensional arrays are used as column vectors:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>              <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="go">array([3, 1])</span>
</pre></div>
</div>
<p>but beware that the transpose of a 1-dimensional array is still 1-dimensional, so the expression <img class="math" src="_images/math/cf3661be6fe1cd23c4d3462f0267bc650b6a6845.png" alt="x^{\rm T} M"/> should be written as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">tensordot:</th><td class="field-body"><p class="first">Compute tensor dot product along specified axes</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">einsum:</th><td class="field-body"><p class="first">Evaluate the Einstein summation convention on the operands</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">eye:</th><td class="field-body"><p class="first last">Return the identity matrix</p>
</td>
</tr>
</tbody>
</table>
<p>The NumPy package <tt class="docutils literal"><span class="pre">linalg</span></tt> has the following functions:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">norm:</th><td class="field-body">Vector or matrix norm</td>
</tr>
<tr class="field-even field"><th class="field-name">inv:</th><td class="field-body">Inverse of a square matrix</td>
</tr>
<tr class="field-odd field"><th class="field-name">solve:</th><td class="field-body">Solve a linear system of equations</td>
</tr>
<tr class="field-even field"><th class="field-name">det:</th><td class="field-body">Determinant of a square matrix</td>
</tr>
<tr class="field-odd field"><th class="field-name">lstsq:</th><td class="field-body">Solve linear least-squares problem</td>
</tr>
<tr class="field-even field"><th class="field-name">pinv:</th><td class="field-body">Pseudo-inverse (Moore-Penrose) calculated using a singular value decomposition</td>
</tr>
<tr class="field-odd field"><th class="field-name">matrix_power:</th><td class="field-body">Integer power of a square matrix</td>
</tr>
</tbody>
</table>
<p>Eigenvalues and decompositions:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">eig:</th><td class="field-body">Eigenvalues and vectors of a square matrix</td>
</tr>
<tr class="field-even field"><th class="field-name">eigh:</th><td class="field-body">Eigenvalues and eigenvectors of a Hermitian matrix</td>
</tr>
<tr class="field-odd field"><th class="field-name">eigvals:</th><td class="field-body">Eigenvalues of a square matrix</td>
</tr>
<tr class="field-even field"><th class="field-name">eigvalsh:</th><td class="field-body">Eigenvalues of a Hermitian matrix</td>
</tr>
<tr class="field-odd field"><th class="field-name">cond:</th><td class="field-body">Compute the condition number of a matrix</td>
</tr>
<tr class="field-even field"><th class="field-name">qr:</th><td class="field-body">QR decomposition of a matrix</td>
</tr>
<tr class="field-odd field"><th class="field-name">svd:</th><td class="field-body">Singular value decomposition of a matrix</td>
</tr>
<tr class="field-even field"><th class="field-name">cholesky:</th><td class="field-body">Cholesky decomposition of a matrix</td>
</tr>
</tbody>
</table>
<p>Tensor operations:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">tensorsolve:</th><td class="field-body">Solve a linear tensor equation</td>
</tr>
<tr class="field-even field"><th class="field-name">tensorinv:</th><td class="field-body">Calculate an inverse of a tensor</td>
</tr>
</tbody>
</table>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="index.html">Python for Data Scientists, 2014.02</a> &raquo;</li> 
      </ul>
    </div>

<a href="www.univ-paris-diderot.fr">
  <img src="_static/paris7.png" alt="Université Paris Diderot / Paris 7" height="80" style="image-orientation: 90deg;">
</a>

<a href="www.apc.univ-paris-diderot.fr">
  <img src="_static/apc.png" alt="Laboratoire APC" height="80">
</a>

<a href="http://univearths.in2p3.fr">
  <img src="_static/labex-univearths.png" alt="UnivEarthS' LabEx" height="80">
</a>

<script language="JavaScript" src="http://freehostedscripts.net/ocount.php?site=ID2440830&name=Visits since 2014.02"></script>

  </body>
</html>