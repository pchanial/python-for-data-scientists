<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>&lt;no title&gt; &mdash; Python for Data Scientists, 2014.02</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2014.02',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Python for Data Scientists, 2014.02" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">Python for Data Scientists, 2014.02</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <p id="plot-oof-py">Fitting of 1/f PSD.</p>
<p><strong>Python source code:</strong> <a class="reference download internal" href="../_downloads/plot_oof.py"><tt class="xref download docutils literal"><span class="pre">plot_oof.py</span></tt></a></p>
<div class="highlight-python"><div class="highlight"><pre>Jm. Colley
&quot;&quot;&quot;
from __future__ import division
import numpy as np
import scipy.optimize as spo
from matplotlib import pyplot as mp
from astropy.io import fits

FREQ_SAMPLING = 180


def spectrum_estimate(signal):
    &quot;&quot;&quot;
    Return power spectrum mode 0 to Nyquist
    &quot;&quot;&quot;
    size_signal = signal.size
    fft_signal = np.fft.fft(signal)
    ps = abs(fft_signal)**2 / size_signal
    return ps[:1 + size_signal // 2]


def oof_model(freq, param):
    &quot;&quot;&quot;
    1/f noise model
        param[0] : noise variance
        param[1] : knee frequency
        param[2] : alpha
    freq : array of frequency
    &quot;&quot;&quot;
    sigma, fknee, alpha = param
    return sigma**2 * (1 + (fknee / freq)**alpha)


def compute_residuals(param, observation, freq):
    &quot;&quot;&quot;
    Return array: observation - model
    &quot;&quot;&quot;
    model = oof_model(freq, param)
    residual = np.log(observation / model)
    print &quot;residual: &quot;, np.sum(residual**2)
    return residual

# read raw signal in fits Table Data
hdulist = fits.open(&#39;plot_oof.fits&#39;)
table = hdulist[1].data
signal = table.ps
nsamples = signal.size

# remove mode 0
spectrum = spectrum_estimate(signal)[1:]

# create array freq mode 1 to Nyquist Mode
delta_freq = FREQ_SAMPLING / nsamples
freq = delta_freq * np.arange(1, nsamples // 2 + 1)

# fit with  scipy optimize, leastsq() function
param_true = np.array([np.std(signal), 1, 1.2])
param_guess = param_true * np.random.uniform(0.5, 2, 3)
ret_lsq = spo.leastsq(compute_residuals, param_guess, args=(spectrum, freq),
                      full_output=True)

param_est, cov_x, infodict, mesg_result, ret_value = ret_lsq
print &quot;Return value:&quot;, ret_value
print &quot;Return message:&quot;, mesg_result

if ret_value not in (1, 2, 3, 4):
    raise RuntimeError(mesg_result)

print &quot;guess    :&quot;, param_guess
print &quot;solution :&quot;, param_est

# plot
mp.figure()
mesg_title = (&#39;Fit of power spectrum: &#39;
              r&#39;${\rm PSD}(f)=\sigma^2&#39;
              r&#39;\left(1+(\frac{f_{\rm knee}}{f})^\alpha\right)$&#39;
              &#39;\n&#39;)
mp.title(mesg_title)
mp.xlabel(&#39;Hertz&#39;)
mp.loglog(freq, spectrum)
mp.loglog(freq, oof_model(freq, param_guess), &#39;.-&#39;)
mp.loglog(freq, oof_model(freq, param_est))
mp.ylim(ymax=1.e-4)
mp.grid()
sigma_param_est = np.sqrt(np.diagonal(cov_x))
mesg_fit = (
    r&#39;     $\sigma={:5.3g}\pm{:3.2g}$&#39;.format(
        param_est[0], sigma_param_est[0]) + &#39;\n&#39; +
    r&#39;fit: $f_{{\rm knee}}={:5.3f}\pm{:3.2f}$&#39;.format(
        param_est[1], sigma_param_est[1]) + &#39;\n&#39; +
    r&#39;     $\alpha={:5.3f}\pm{:3.2f}$&#39;.format(
        param_est[2], sigma_param_est[2]))
mp.legend([&#39;raw spectrum&#39;, &#39;guess&#39;, mesg_fit], loc=&#39;best&#39;)
mp.show()
</pre></div>
</div>
<img alt="../_images/plot_oof.png" class="align-center" src="../_images/plot_oof.png" />


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">Python for Data Scientists, 2014.02</a> &raquo;</li> 
      </ul>
    </div>

<a href="www.univ-paris-diderot.fr">
  <img src="../_static/paris7.png" alt="UniversitÃ© Paris Diderot / Paris 7" height="80" style="image-orientation: 90deg;">
</a>

<a href="www.apc.univ-paris-diderot.fr">
  <img src="../_static/apc.png" alt="Laboratoire APC" height="80">
</a>

<a href="http://univearths.in2p3.fr">
  <img src="../_static/labex-univearths.png" alt="UnivEarthS' LabEx" height="80">
</a>

<script language="JavaScript" src="http://freehostedscripts.net/ocount.php?site=ID2440830&name=Visits since 2014.02"></script>

  </body>
</html>